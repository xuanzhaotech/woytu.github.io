(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{638:function(t,s,a){"use strict";a.r(s);var e=a(4),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"powershell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#powershell"}},[t._v("#")]),t._v(" PowerShell")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#flag"}},[t._v("flag")])]),a("li",[a("a",{attrs:{href:"#在batch中嵌入运行"}},[t._v("在batch中嵌入运行")])]),a("li",[a("a",{attrs:{href:"#命令"}},[t._v("命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#系统环境变量"}},[t._v("系统环境变量")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"flag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag"}},[t._v("#")]),t._v(" flag")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("PowerShell")]),t._v("的命令叫做"),a("code",[t._v("cmdlet")]),t._v("("),a("code",[t._v("command-let")]),t._v("), 采用了“动词-名词”的命名方式，动词部分取自于一个制定的动词集合，\n名词部分则描述了命令要操作的对象。例如，"),a("code",[t._v("Get-Command")]),t._v("就是指获取"),a("code",[t._v("PowerShell")]),t._v("中所有"),a("code",[t._v("cmdlet")]),t._v("命令。")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("PowerShell")]),t._v("提供对"),a("code",[t._v("COM")]),t._v("（组件对象模型）和"),a("code",[t._v("WMI")]),t._v("（Windows管理规范）的完全访问，具有丰富的控制与自动化的系统管理能力，\n能够轻松地做到实时、大规模的管理系统。获取本机所有"),a("code",[t._v("COM")]),t._v("组件对象脚本 "),a("a",{attrs:{href:"/files/Get-COM-Objects.ps1"}},[t._v("Get-COM-Objects.ps1")])])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.zhihu.com/question/22611859/answers/updated",target:"_blank",rel:"noopener noreferrer"}},[t._v("PowerShell 与 cmd 有什么不同？"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.pstips.net/why-is-powershell-powerful.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PowerShell为什么强大"),a("OutboundLink")],1)])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/powershell/scripting/how-to-use-docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何使用 PowerShell 文档"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.pstips.net/powershell-online-tutorials",target:"_blank",rel:"noopener noreferrer"}},[t._v("PowerShell 在线教程"),a("OutboundLink")],1)])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/PowerShell",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/PowerShell"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows/wsl/install-win10",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装适用于 Linux 的 Windows 子系统"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("包管理")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/oneget/oneget",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/oneget/oneget"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.nuget.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.nuget.org"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/chocolatey",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/chocolatey"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/lukesampson/scoop",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/lukesampson/scoop"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/cmderdev/cmder",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/cmderdev/cmder"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("终端")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/topics/windows",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/topics/windows"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/microsoft/terminal",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/microsoft/terminal"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/appget",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/appget"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/x64dbg",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/x64dbg"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/Maximus5/ConEmu",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Maximus5/ConEmu"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/Eugeny/terminus",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Eugeny/terminus"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/Sycnex/Windows10Debloater",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Sycnex/Windows10Debloater"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"在batch中嵌入运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在batch中嵌入运行"}},[t._v("#")]),t._v(" 在batch中嵌入运行")]),t._v(" "),a("blockquote",[a("p",[t._v("由于Power Shell默认没有开启运行脚本策略，可以以此方式解决")])]),t._v(" "),a("blockquote",[a("p",[t._v("正则表达式排除以"),a("code",[t._v("@")]),t._v("和"),a("code",[t._v(":")]),t._v("开头的行，并将其他所有内容传递给Power Shell")])]),t._v(" "),a("div",{staticClass:"language-batch extra-class"},[a("pre",{pre:!0,attrs:{class:"language-batch"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token command"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("findstr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter attr-name"}},[t._v("/v")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^@.* ^:.*"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%~f0"')]),t._v("|powershell -")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token command"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v(":eof")])]),t._v("\n<# 从这里开始是 Power Shell代码 #>\n")])])]),a("blockquote",[a("p",[t._v("这里巧妙的借用Power Shell的注释把bat脚本命令包裹，把整个脚本内容传入Power Shell并执行")])]),t._v(" "),a("div",{staticClass:"language-batch extra-class"},[a("pre",{pre:!0,attrs:{class:"language-batch"}},[a("code",[t._v("<# ::\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token command"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("powershell")]),t._v(" -<"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("%~f0")]),t._v(" ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token command"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v(":eof")])]),t._v("\n#>\n# 从这里开始是 Power Shell代码\n")])])]),a("h2",{attrs:{id:"命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[t._v("#")]),t._v(" 命令")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.holoem.com/?p=1974",target:"_blank",rel:"noopener noreferrer"}},[t._v("Scheduled Tasks（计划任务）"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.archive",target:"_blank",rel:"noopener noreferrer"}},[t._v("压缩解压文件"),a("OutboundLink")],1)])]),t._v(" "),a("ul",[a("li",[t._v("查看版本")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看Power Shell版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PSVersionTable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PSVersion\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Major\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看当前PowerShell的.Net运行版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PSVersionTable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CLRVersion\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有安装的.Net 版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HKLM:\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort-object")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Descending "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("select-object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ExpandProperty PSChildName\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看安装的.Net 客户端版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-ItemProperty")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HKLM:\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4\\Client'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Name Version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Version\n")])])]),a("ul",[a("li",[t._v("为本账户启用执行脚本策略")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ExecutionPolicy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ExecutionPolicy RemoteSigned "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Scope CurrentUser\n")])])]),a("ul",[a("li",[t._v("下载代码并通过"),a("code",[t._v("Invoke-Expression")]),t._v("执行")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Expression")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WebClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DownloadString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://get.scoop.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("下载文件")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WebClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DownloadFile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://git.io/JvYAg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'d:\\\\7za.exe'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("恢复计算器")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("Get"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AppxPackage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("calculator"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AllUsers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Foreach")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Add"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AppxPackage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DisableDevelopmentMode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Register "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InstallLocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v('\\AppXManifest.xml"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("循环目录")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取子目录和文件并遍历")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-ChildItem")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ForEach-Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Process")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project_name")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果为子目录")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[System.IO.DirectoryInfo]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换到子目录")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FullName\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 判断目录是否存在")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Test-Path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            git remote "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PadLeft"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("15"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始更新 '),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project_name")]),t._v(' "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PadRight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            git pull\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-Location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("创建文件夹")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Item")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ItemType directory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path 目录的路径\n")])])]),a("ul",[a("li",[t._v("格式化时间")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Date")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Format "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yyy-MM-dd hh:mm:ss'")]),t._v("\n")])])]),a("ul",[a("li",[t._v("下载安装7z")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$response")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-WebRequest")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Uri https:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("7"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("zip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取文件名")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Content "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Select-String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Pattern "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<A href=\"(?<url>a\\/7z\\d+-x64\\.msi)\">Download<\\/A>'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拼接下载url")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.7-zip.org/"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Matches"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Groups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'url'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求下载")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-WebRequest")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Uri "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$url")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("OutFile 7zip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msi\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用msiexec解压msi到7zip目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$process")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start-Process")]),t._v(" msiexec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ArgumentList "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/a 7zip.msi /qn TARGETDIR=`"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v('\\7zip`""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("PassThru\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Wait-Process")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Id "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$process")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Move-Item")]),t._v(" 7zip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Files"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("7"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Zip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("7z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe 7z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Move-Item")]),t._v(" 7zip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Files"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("7"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Zip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("7z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dll 7z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dll "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-Item")]),t._v(" –path 7zip –Recurse\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-Item")]),t._v(" –path 7zip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msi\n")])])]),a("p",[a("strong",[t._v("调用DLL")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DllImport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kernel32.dll"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nprivate static extern int GetPrivateProfileSection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("string lpAppName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" byte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" lpszReturnBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int nSize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string lpFileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v(" Lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WorkStation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$signature")]),t._v(" = @"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\n        [DllImport("')]),t._v("user32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dll"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", SetLastError = true)]\n        public static extern bool LockWorkStation();\n    "')]),t._v("@\n    \n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$LockWorkStation")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add-Type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("memberDefinition "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$signature")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Win32LockWorkStation"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("namespace Win32Functions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("passthru\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$LockWorkStation")]),t._v("::LockWorkStation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Out-Null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("解压zip")])]),t._v(" "),a("ul",[a("li",[t._v("PowerShell 5.0或更高版本(已预安装Windows 10和Windows Server 2016)")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("Compress"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Archive "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path 解压到目录路径 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DestinationPath 压缩文件路径\nExpand"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Archive "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path 解压到目录路径 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DestinationPath 压缩文件路径 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Overwrite")]),t._v("\n")])])]),a("ul",[a("li",[t._v("需要.net 4.5以上")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add-Type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("assembly "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system.io.compression.filesystem"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[io.compression.zipfile]")]),t._v("::ExtractToDirectory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("压缩文件路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 解压到目录路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("PowerShell 2.0以上")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" UnzipFile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[string]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sourceFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[string]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$targetFolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Test-Path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$targetFolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mkdir "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$targetFolder")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$shellApp")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ComObject Shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Application\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$files")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$shellApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NameSpace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$souceFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# foreach ($item in $files) {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     $shell.Namespace($targetFolder).CopyHere($item)")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$shellApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NameSpace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$targetFolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CopyHere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"系统环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统环境变量"}},[t._v("#")]),t._v(" 系统环境变量")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("列出所有的环境变量："),a("code",[t._v("Get-ChildItem env:")]),t._v(" 同 "),a("code",[t._v("dir env:")])])]),t._v(" "),a("li",[a("p",[t._v("获取环境变量的值："),a("code",[t._v("$env:变量名")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);