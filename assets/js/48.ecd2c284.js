(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{631:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql备份恢复数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql备份恢复数据"}},[s._v("#")]),s._v(" MySQL备份恢复数据")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#通过binlog2sql恢复数据"}},[s._v("通过binlog2sql恢复数据")]),t("ul",[t("li",[t("a",{attrs:{href:"#mysql必须设置参数"}},[s._v("MySQL必须设置参数")])]),t("li",[t("a",{attrs:{href:"#user需要的最小权限集合"}},[s._v("user需要的最小权限集合")])]),t("li",[t("a",{attrs:{href:"#查看目前的binlog文件"}},[s._v("查看目前的binlog文件")])]),t("li",[t("a",{attrs:{href:"#定位误操作sql的binlog位置"}},[s._v("定位误操作SQL的binlog位置")])]),t("li",[t("a",{attrs:{href:"#生成-sql-文件回滚"}},[s._v("生成sql文件回滚")])]),t("li",[t("a",{attrs:{href:"#不生成-sql-文件回滚"}},[s._v("不生成sql文件回滚")])])])]),t("li",[t("a",{attrs:{href:"#mysqldump-备份恢复"}},[s._v("mysqldump备份恢复")]),t("ul",[t("li",[t("a",{attrs:{href:"#参数说明"}},[s._v("参数说明")])]),t("li",[t("a",{attrs:{href:"#导出"}},[s._v("导出")])]),t("li",[t("a",{attrs:{href:"#导入"}},[s._v("导入")])]),t("li",[t("a",{attrs:{href:"#mysqldump-两台主机同步备份"}},[s._v("mysqldump两台主机同步备份")])]),t("li",[t("a",{attrs:{href:"#mysqldump-其他命令"}},[s._v("mysqldump其他命令")])])])]),t("li",[t("a",{attrs:{href:"#脚本"}},[s._v("脚本")]),t("ul",[t("li",[t("a",{attrs:{href:"#备份并删除历史"}},[s._v("备份并删除历史")])]),t("li",[t("a",{attrs:{href:"#同步远程数据库到本地"}},[s._v("同步远程数据库到本地")])])])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"通过binlog2sql恢复数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过binlog2sql恢复数据"}},[s._v("#")]),s._v(" 通过binlog2sql恢复数据")]),s._v(" "),t("blockquote",[t("p",[s._v("使用此方式之前一定是MySQL开启了bin-log的才可行")]),s._v(" "),t("blockquote",[t("p",[s._v("如果没有安装开源工具"),t("code",[s._v("binlog2sql")]),s._v("那么请安装。")])]),s._v(" "),t("p",[s._v("binlog2sql的使用详情：https://github.com/danfengcao/binlog2sql")]),s._v(" "),t("p",[s._v("binlog2sql是一款简单易用的binlog解析工具，其中一个功能就是生成回滚SQL。")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/danfengcao/binlog2sql.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" binlog2sql/\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -r requirements.txt\n")])])]),t("h3",{attrs:{id:"mysql必须设置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql必须设置参数"}},[s._v("#")]),s._v(" MySQL必须设置参数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nlog_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/mysql/mysql-bin.log\nmax_binlog_size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1G\nbinlog_format "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" row\nbinlog_row_image "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" full\n")])])]),t("h3",{attrs:{id:"user需要的最小权限集合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#user需要的最小权限集合"}},[s._v("#")]),s._v(" user需要的最小权限集合")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" super"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("replication")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("replication")]),s._v(" slave\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#建议授权")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" CLIENT "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" \n")])])]),t("h3",{attrs:{id:"查看目前的binlog文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看目前的binlog文件"}},[s._v("#")]),s._v(" 查看目前的binlog文件")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master logs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("ul",[t("li",[s._v("查询结果")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("Log_name")]),s._v(" "),t("th",[s._v("File_size")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("mysql-bin.000001")]),s._v(" "),t("td",[s._v("177")])]),s._v(" "),t("tr",[t("td",[s._v("mysql-bin.000002")]),s._v(" "),t("td",[s._v("437")])]),s._v(" "),t("tr",[t("td",[s._v("mysql-bin.000003")]),s._v(" "),t("td",[s._v("685")])]),s._v(" "),t("tr",[t("td",[s._v("mysql-bin.000004")]),s._v(" "),t("td",[s._v("1702399")])]),s._v(" "),t("tr",[t("td",[s._v("mysql-bin.000005")]),s._v(" "),t("td",[s._v("963964")])]),s._v(" "),t("tr",[t("td",[s._v("mysql-bin.000006")]),s._v(" "),t("td",[s._v("13118637")])]),s._v(" "),t("tr",[t("td",[s._v("mysql-bin.000007")]),s._v(" "),t("td",[s._v("26765043")])])])]),s._v(" "),t("h3",{attrs:{id:"定位误操作sql的binlog位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定位误操作sql的binlog位置"}},[s._v("#")]),s._v(" 定位误操作SQL的binlog位置")]),s._v(" "),t("blockquote",[t("p",[s._v("可以看到最新的binlog文件是mysql-bin.000007，我们再定位误操作SQL的binlog位置")]),s._v(" "),t("p",[t("code",[s._v("binlog2sql.py")]),s._v("文件在"),t("code",[s._v("binlog2sql/binlog2sql/")]),s._v("文件夹下")]),s._v(" "),t("p",[s._v("如果命令最后不加时间可输出最近操作的SQL命令")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python binlog2sql/binlog2sql.py -h127.0.0.1 -P端口 -u账号 -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(" -d数据库 -t表 --start-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog文件'")]),s._v(" --start-datetime"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'之前误操作的SQL执行开始时间'")]),s._v(" --stop-datetime"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'之前误操作的SQL执行结束时间'")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("当程序跑完之后看最后一条数据最末尾：")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("#start 5117865 end 13679060 time 2018-06-12 10:07:53")])]),s._v(" "),t("p",[s._v("开始位置（start 5117865）和结束位置（end 13679060）")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/MySQL_binlog.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"生成sql文件回滚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成sql文件回滚"}},[s._v("#")]),s._v(" 生成"),t("code",[s._v("sql")]),s._v("文件回滚")]),s._v(" "),t("blockquote",[t("p",[s._v("生成"),t("code",[s._v("rollback.sql")]),s._v("文件，并检查回滚SQL是否正确")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python binlog2sql/binlog2sql.py -h127.0.0.1 -P端口 -u账号 -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(" -d数据库 -t表 --start-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog文件'")]),s._v(" --start-position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("开始位置 --stop-position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("结束位置 -B "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" rollback.sql\n")])])]),t("blockquote",[t("p",[s._v("查看当前文件夹下是否生成了rollback.sql文件,确认回滚SQL正确，如果有就执行回滚")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql -h127.0.0.1 -P端口 -u账号 -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" rollback.sql\n")])])]),t("h3",{attrs:{id:"不生成sql文件回滚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不生成sql文件回滚"}},[s._v("#")]),s._v(" 不生成"),t("code",[s._v("sql")]),s._v("文件回滚")]),s._v(" "),t("blockquote",[t("p",[s._v("不生成rollback.sql文件，执行命令后在输出中检查回滚SQL是否正确")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python binlog2sql/binlog2sql.py -h127.0.0.1 -P端口 -u账号 -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(" -d数据库 -t表 --start-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog文件'")]),s._v(" --start-position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("开始位置 --stop-position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("结束位置 -B\n")])])]),t("blockquote",[t("p",[s._v("确认回滚SQL正确，执行回滚语句。登录MySQL确认，数据回滚成功。")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python binlog2sql/binlog2sql.py -h127.0.0.1 -P端口 -u账号 -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(" -d数据库 -t表 --start-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog文件'")]),s._v(" --start-position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("开始位置 --stop-position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("结束位置 -B "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql -h127.0.0.1 -P端口 -u账号 -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v("\n")])])]),t("h2",{attrs:{id:"mysqldump备份恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump备份恢复"}},[s._v("#")]),s._v(" "),t("code",[s._v("mysqldump")]),s._v("备份恢复")]),s._v(" "),t("blockquote",[t("p",[s._v("如果是在本机上备份本机的数据库地址和端口可以不要，如果是在本机上备份其他主机上的数据库就需要地址和端口")]),s._v(" "),t("p",[t("code",[s._v("mysqldump")]),s._v("命令需要手动输入密码，所以一般不输入"),t("code",[s._v("-p")]),s._v("参数")])]),s._v(" "),t("h3",{attrs:{id:"参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("-d")]),s._v(" 结构(--no-data:不导出任何数据，只导出数据库表结构)")]),s._v(" "),t("p",[t("code",[s._v("-t")]),s._v(" 数据(--no-create-info:只导出数据，而不添加CREATE TABLE 语句)")]),s._v(" "),t("p",[t("code",[s._v("-n")]),s._v(" (--no-create-db:只导出数据，而不添加CREATE DATABASE 语句）")]),s._v(" "),t("p",[t("code",[s._v("-R")]),s._v(" (--routines:导出存储过程以及自定义函数)")]),s._v(" "),t("p",[t("code",[s._v("-E")]),s._v(" (--events:导出事件)")]),s._v(" "),t("p",[t("code",[s._v("--triggers")]),s._v(" (默认导出触发器，使用--skip-triggers屏蔽导出)")]),s._v(" "),t("p",[t("code",[s._v("-B")]),s._v(" (--databases:导出数据库列表，单个库时可省略）")]),s._v(" "),t("p",[t("code",[s._v("--tables")]),s._v(" 表列表（单个表时可省略）")]),s._v(" "),t("blockquote",[t("p",[s._v("①同时导出结构以及数据时可同时省略-d和-t")]),s._v(" "),t("p",[s._v("②同时不导出结构和数据可使用-ntd")]),s._v(" "),t("p",[s._v("③只导出存储过程和函数可使用-R -ntd")]),s._v(" "),t("p",[s._v("④导出所有(结构&数据&存储过程&函数&事件&触发器)使用-R -E(相当于①，省略了-d -t;触发器默认导出)")]),s._v(" "),t("p",[s._v("⑤只导出结构&函数&事件&触发器使用 -R -E -d")])])]),s._v(" "),t("h3",{attrs:{id:"导出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导出"}},[s._v("#")]),s._v(" 导出")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只导出结构&函数&事件&触发器使用")]),s._v("\nmysqldump -R -E -d -h需要备份的主机地址 -P端口 -u用户名 -p 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/backup.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只导出存储过程和函数可使用")]),s._v("\nmysqldump -R -ntd -h需要备份的主机地址 -P端口 -u用户名 -p 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/backup.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出单个数据库中所有(结构&数据&存储过程&函数&事件&触发器)到sql文件")]),s._v("\nmysqldump -R -E -h需要备份的主机地址 -P端口 -u用户名 -p 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/backup.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqldump 备份并压缩sql文件")]),s._v("\nmysqldump -R -E -h主机地址 -P端口 -u用户名 -p 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/backup.sql.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份所有的数据库到一个sql文件")]),s._v("\nmysqldump -R -E -h主机地址 -P端口 -u用户名 -p --all-databases "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/all.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从一个数据库导出到另一个数据库")]),s._v("\nmysqldump -R -E -u用户名 -p 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql 新数据库名 -u用户名 -p密码\n")])])]),t("h3",{attrs:{id:"导入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入"}},[s._v("#")]),s._v(" 导入")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用mysqldump导入本地sql文件")]),s._v("\nmysqldump -h主机地址 -P端口 -u用户名 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /home/backup.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql直接用压缩文件恢复")]),s._v("\ngunzip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" backup.sql.gz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql -h主机地址 -P端口 -u用户名 -p密码 数据库名\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql从本地sql文件导入")]),s._v("\nmysql -h主机地址 -P端口 -u用户名 -p密码 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" backupfile.sql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录MySQL用source命令导入本地sql文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定数据库")]),s._v("\nuse 数据库名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入数据（注意sql文件的路径）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /home/backup.sql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),t("h3",{attrs:{id:"mysqldump两台主机同步备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump两台主机同步备份"}},[s._v("#")]),s._v(" "),t("code",[s._v("mysqldump")]),s._v("两台主机同步备份")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqldump -R -E -h导出的主机地址 -P端口 -u用户名 -p 数据库名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql -h导入的主机地址 -P端口 -u用户名 -p密码 -C 数据库名\n")])])]),t("blockquote",[t("p",[s._v("--opt等同于--add-drop-table，--add-locks，--create-options，--quick，--extended-insert，--lock-tables，--set-charset，--disable-keys。\n该选项默认开启， 可以用--skip-opt禁用。")]),s._v(" "),t("blockquote",[t("p",[s._v("1、--opt 在创建表结构之前 会有 DROP TABLE IF EXISTS")])])]),s._v(" "),t("blockquote",[t("blockquote",[t("p",[s._v("2、原表在创建的时候指定了AUTO_INCREMENT，在使用了--opt 仍然和建表时候一样存在参数，在使用参数--skip-opt的时候，忽略了此参数AUTO_INCREMENT")])])]),s._v(" "),t("blockquote",[t("blockquote",[t("p",[s._v("3、在使用参数--opt的时候，创建表的类型，字符集等等都是默认参数ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;当使用了--skip-opt的时候，这些参数都给忽略了")])])]),s._v(" "),t("blockquote",[t("blockquote",[t("p",[s._v("4、导出原表中的数据，--opt是一个insert多个value，在使用了--skip-opt的时候，是多个insert组成的；")])])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/hao7030187/article/details/77839968",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysqldump数据导出参数说明"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"http://www.cnblogs.com/chenmh/p/5300370.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysqldump数据导出参数说明"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"mysqldump其他命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump其他命令"}},[s._v("#")]),s._v(" "),t("code",[s._v("mysqldump")]),s._v("其他命令")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("mysqldump")]),s._v("导入导出结构，数据，存储过程，函数，事件，触发器")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1.①导出一个库结构\n\nmysqldump -d dbname -u root -p > xxx.sql\n\n②导出多个库结构\n\nmysqldump -d -B dbname1 dbname2 -u root -p > xxx.sql\n\n2.①导出一个库数据\n\nmysqldump -t dbname -u root -p > xxx.sql\n\n②导出多个库数据\n\nmysqldump -t -B dbname1 dbname2 -u root -p > xxx.sql\n \n\n3.①导出一个库结构以及数据\n\nmysqldump dbname1 -u root -p > xxx.sql\n\n②导出多个库结构以及数据\n\nmysqldump -B dbname1 dbname2 -u root -p > xxx.sql\n\n-------------------------数据表操作-----------------------------\n\n4.①导出一个表结构\n\nmysqldump -d dbname1 tablename1 -u root -p > xxx.sql\n\n②导出多个表结构\n\nmysqldump -d -B dbname1 --tables tablename1 tablename2 -u root -p > xxx.sql\n \n\n5.①导出一个表数据\n\nmysqldump -t dbname1 tablename1 -u root -p > xxx.sql\n\n②导出多个表数据\n\nmysqldump -d -B dbname1 --tables tablename1 tablename2 -u root -p > xxx.sql\n \n\n6.①导出一个表结构以及数据\n\nmysqldump dbname1 tablename1 -u root -p > xxx.sql\n\n②导出多个表结构以及数据\n\nmysqldump -B dbname1 --tables tablename1 tablename2 -u root -p > xxx.sql\n\n-------------------------存储过程、函数操作-----------------------------\n\n7.只导出存储过程和函数(不导出结构和数据，要同时导出结构的话，需要同时使用-d)\n\nmysqldump -R -ndt dbname1 -u root -p > xxx.sql\n \n-------------------------事件操作-----------------------------\n8.只导出事件\n\nmysqldump -E -ndt dbname1 -u root -p > xxx.sql\n \n-------------------------触发器操作-----------------------------\n\n9.不导出触发器（触发器是默认导出的–triggers，使用–skip-triggers屏蔽导出触发器）\n\nmysqldump --skip-triggers dbname1 -u root -p > xxx.sql\n")])])]),t("h2",{attrs:{id:"脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#脚本"}},[s._v("#")]),s._v(" 脚本")]),s._v(" "),t("h3",{attrs:{id:"备份并删除历史"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备份并删除历史"}},[s._v("#")]),s._v(" 备份并删除历史")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"****************************************************************************"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("startDate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"★['),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$startDate")]),s._v('] 开始执行："')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----------------------------------------------------------------------------"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("finish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----------------------------------------------------------------------------"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("endDate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"★['),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$endDate")]),s._v('] 执行结束！"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"****************************************************************************"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ============ 以下配置信息请自行修改 ===================")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MySQL备份用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"USER"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MySQL备份用户的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PASSWORD"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3306"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MySQL编码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_charset")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf8"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 要备份的数据库名称，多个用空格分开隔开 如("db1" "db2" "db3")')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_db_arr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 备份数据存放位置，末尾请不要带"/",此项可以保持默认，程序会自动创建文件夹')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_location")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/mysqlBackup\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启过期备份删除 ON为开启 OFF为关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("expire_backup_delete")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ON"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 过期时间天数 默认为三天，此项只有在expire_backup_delete开启时有效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("expire_days")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ============= 本行开始不需要修改 ===================")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义备份详细时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d%H%M"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3天之前的日期")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#backup_3ago=$(date -d '3 days ago' +%Y-%m-%d)")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义备份目录中的年月日时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#backup_Ymd=`date +%Y-%m-%d`")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份文件夹全路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#backup_dir=$backup_location/$backup_Ymd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_dir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_location")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断MYSQL是否启动,mysql没有启动则备份退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_ps")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_listen")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -an "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" LISTEN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $mysql_port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -o "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"错误：MySQL没有运行！备份停止！"')]),s._v("\n    finish\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接到mysql数据库，无法连接则备份退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以用shell脚本操作mysql数据库，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用mysql的-e参数可以执行各种sql的(创建，删除，增，删，改、查)等各种操作 。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("databases")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("mysql -h$mysql_host -P$mysql_port -u$mysql_user "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-p$mysql_password -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"show databases;"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flag")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $?"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$flag")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"错误：无法连接mysql服务器！备份停止！"')]),s._v("\n    finish\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MySQL连接成功! 请等待......"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有定义备份的数据库，则退出备份")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_db_arr")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"错误：没有定义备份的数据库"')]),s._v("\n    finish\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#dbnames=$(cut -d ',' -f1-5 $backup_database)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#echo "arr is (${backup_db_arr[@]})"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("dbname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_db_arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库 '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dbname")]),s._v(' 备份开始..."')]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 过滤查询出的数据库中是否有当前数据库")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("result")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $databases "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -o $dbname"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果定义备份的数据库不存在，则备份停止")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$result")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"错误：数据库中没有查到此数据库'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dbname")]),s._v('！"')]),s._v("\n        finish\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建备份文件夹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p $backup_dir"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始备份")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("\n        mysqldump -h$mysql_host -P$mysql_port -u$mysql_user "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        -p$mysql_password $dbname --default-character-set"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$mysql_charset "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("$backup_dir/$dbname-$backup_time.sql.gz\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取执行结果")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flag")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $?"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$flag")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库 '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dbname")]),s._v(" 成功备份到 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_dir")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dbname")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_time")]),s._v('.sql.gz"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库 '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dbname")]),s._v(' 备份失败!"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果开启了删除过期备份，则进行删除操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$expire_backup_delete")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ON"')]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_dir")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查找要删除的文件："')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查找要删除的文件")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" $backup_dir/ -type f -mtime +$expire_days -print"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始查找并删除")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" $backup_dir/ -type f -mtime +$expire_days -print "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"删除备份文件成功!"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\nfinish\n\n")])])]),t("h3",{attrs:{id:"同步远程数据库到本地"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同步远程数据库到本地"}},[s._v("#")]),s._v(" 同步远程数据库到本地")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"****************************************************************************"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("startDate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"★['),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$startDate")]),s._v('] 开始执行："')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----------------------------------------------------------------------------"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 远程数据库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ip"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"端口"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_USER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"密码"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_DB")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kcyw"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地数据库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCAL_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCAL_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3306"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCAL_USER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCAL_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"密码"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果本地数据库不存在则创建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("create_db_sql")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create database IF NOT EXISTS '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_DB}")]),s._v('"')]),s._v("\nmysql -h"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_HOST}")]),s._v(" -P"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_PORT}")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_USER}")]),s._v(" -p"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_PASSWORD}")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${create_db_sql}")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从远程数据库备份到本地数据库")]),s._v("\nmysqldump -R -E -h"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_HOST}")]),s._v(" -P"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_PORT}")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_USER}")]),s._v(" -p"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_PASSWORD}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_DB}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql -h"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_HOST}")]),s._v(" -P"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_PORT}")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_USER}")]),s._v(" -p"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOCAL_PASSWORD}")]),s._v(" -C "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_DB}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----------------------------------------------------------------------------"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("endDate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"★['),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$endDate")]),s._v('] Successful"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"****************************************************************************"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);